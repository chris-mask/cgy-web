webpackJsonp([53],{B91U:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,"\n.box-card[data-v-23f33d73] {\n  margin-bottom: 10px;\n}\n.headerLeft[data-v-23f33d73] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.headerLeft .conditionChoose[data-v-23f33d73] {\n  font-size: 16px;\n  color: #444 !important;\n}\n.headerLeft .conditionChoose[data-v-23f33d73]::before {\n  content: '';\n  border-left: 2px solid #03adf4;\n  margin-right: 15px;\n}\n.headerLeft .condOring[data-v-23f33d73]::before {\n  content: '';\n  border-left: 2px solid #ffa01c;\n  margin-right: 15px;\n}\n.payName[data-v-23f33d73] {\n  font-size: 14px;\n  display: inline-block;\n}\n.payName span[data-v-23f33d73] {\n  color: #69ccff;\n  margin-right: 10px;\n}\n.el-row[data-v-23f33d73] {\n  margin-bottom: 15px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.el-row[data-v-23f33d73]:last-child {\n  margin-bottom: 0;\n}\n[data-v-23f33d73] .el-card__header {\n  padding: 12px 13px;\n}\n[data-v-23f33d73] .el-input {\n  width: auto;\n}\n[data-v-23f33d73] .el-select {\n  display: inline-block !important;\n}\n.btnList[data-v-23f33d73] {\n  text-align: center;\n}\n",""])},NJwx:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("mvHQ"),s=a.n(r),o=a("woOf"),i=a.n(o),n=a("l8D1"),l=a("c8+v"),c=a("Q5rI"),d=a("jlNU"),m=a("gu65"),p={activated:function(){this.recordForm={},this.isCheck=this.$route.query.isCheck,this.recordForm.recordId=this.$route.query.recordId,this.recordForm.recordId&&this.getDetail(),this.getPersonList("业务员,业务主管")},data:function(){return{recordForm:{},fileForm:{},paymentLevelList:[{label:"国家级",value:"1"},{label:"省级",value:"2"},{label:"市级",value:"3"},{label:"区县级",value:"4"},{label:"镇街级",value:"5"}],isCheck:!1,fileList:[],recheckFileList:[],dialogVisible:!1,payMethods:[]}},methods:{getDetail:function(){var e=this;Object(n.r)({recordId:this.recordForm.recordId}).then(function(t){if(200==t.code){if(i()(e.recordForm,t.data.crmContractVo,t.data.crmCustomerVo,t.data.orderDetailVo,t.data.paymentRecordVo),e.recordForm=JSON.parse(s()(e.recordForm)),e.recordForm.basisFileIds&&""!=e.recordForm.basisFileIds){var a=[e.recordForm.basisFileIds];e.getFileDetail(a,1)}if(e.recordForm.recheckFileIds&&""!=e.recordForm.recheckFileIds){var r=[e.recordForm.recheckFileIds];e.getFileDetail(r,2)}e.getPaymentData(t.data.paymentRecordVo.orderId)}})},getFileDetail:function(e,t){var a=this;Object(c.k)({fileIds:e,haveView:!0}).then(function(e){200==e.code?(1==t&&(a.fileList=e.data.map(function(e){return e.name=e.fileName,e}),setTimeout(function(){a.$set(a.fileForm,"file",e.data[0]),a.$set(a.fileForm,"fileIds",e.data[0].fileId),a.$set(a.fileForm,"fileName",e.data[0].fileName),a.$set(a.fileForm,"fileUrl",e.data[0].fileUrl)},300)),2==t&&(a.recheckFileList=e.data.map(function(e){return e.name=e.fileName,e}),setTimeout(function(){a.$set(a.recordForm,"file",e.data[0]),a.$set(a.recordForm,"fileIds",e.data[0].fileId),a.$set(a.recordForm,"fileName",e.data[0].fileName),a.$set(a.recordForm,"fileUrl",e.data[0].fileUrl)}))):a.$message.warning(e.message)})},downloadFile:function(e){e.filePath&&Object(c.q)(e).then(function(e){if(200==e.code){var t=e.data.replace(/http/,"https");window.open(t)}})},getPersonList:function(e,t){var a=this,r=new FormData;r.append("roleNameList",e),void 0!=t&&r.append("deptIdList",t),Object(l.E)(r).then(function(e){200==e.code?a.userList=e.data:a.$message.warning(e.message)})},openEdit:function(){this.isCheck=!0},editPayment:function(){var e=this;if(0==this.recordForm.typeMoney){if(this.recordForm.commission>100)return void this.$message.warning("比例不得大于100%");this.recordForm.commission=this.recordForm.commission/100}1==this.recordForm.typeMoney&&this.recordForm.commission>=this.recordForm.paymentAmount?this.$message.warning("提成不得大于或等于回款金额"):Object(n.C)(this.recordForm).then(function(t){200==t.code&&(e.$message.success("修改成功"),e.recordForm={},e.fileList=[],e.recheckFileList=[],e.$store.commit("SET_CONTRACT_SCROLL",0),e.closeCurrent(e.$store.state.tagsView.visitedViews,e.$route,"/contract"))})},openRecheck:function(){this.dialogVisible=!0},recheckPayment:function(e){var t=this;this.$confirm("你确定审核吗？确定后即可生效","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.recordForm.recheckResult=e,Object(n.D)(t.recordForm).then(function(e){200==e.code&&(t.$message({type:"success",message:"审核成功"}),t.dialogVisible=!1,t.closeCurrent(t.$store.state.tagsView.visitedViews,t.$route,"/contract"))})}).catch(function(e){})},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},uploadBeforeFile:function(e){var t="image/jpeg"===e.type||"image/png"===e.type;return t||this.$message.error("上传头像图片只能是 JPG或者png 格式!"),t},handleUpload:function(e){var t=this;if(!this.recordForm.crmCompanyName||""==this.planBackForm.crmCompanyName)return this.$message.error("企业名称为空，请检查"),void(this.recheckFileList=JSON.parse(s()(this.recheckFileList)));if(!this.recordForm.projectName||""==this.recordForm.projectName)return this.$message.error("项目名称为空，请检查"),void(this.recheckFileList=JSON.parse(s()(this.recheckFileList)));if(e.file.name.length>=150)return this.$message.error("文件名称超长，请检查"),void(this.recheckFileList=JSON.parse(s()(this.recheckFileList)));var a=e.file.size/1024;if(a>this.$store.getters.singleCapacity)return this.$message.error("文件大小超出限制，上传失败"),void(this.recheckFileList=JSON.parse(s()(this.recheckFileList)));if(a>this.$store.getters.totalCapacity)return this.$message.error("文件大小超出容量剩余空间，上传失败"),void(this.recheckFileList=JSON.parse(s()(this.recheckFileList)));var r=e.file.name.lastIndexOf("."),o=e.file.name.substring(0,r),i=e.file.name.substring(r+1,e.file.name.length),n=Object(m.l)(this.recordForm.crmCompanyName,this.recordForm.projectName,"其他资料",o)+"."+i;Object(d.a)(n,e.file,e).then(function(r){if(r){var o=[],l={fileName:e.file.name,filePath:n,fileSize:a,fileType:i,parentType:4};o.push(l);var d={companyId:t.recordForm.crmCompanyId,companyName:t.recordForm.crmCompanyName,addFileDtos:o,haveView:!0};Object(c.a)(d).then(function(e){200==e.code?(t.$message.success("上传成功"),t.$set(t.recordForm,"recheckFileIds",e.data[0].fileId),t.$set(t.recordForm,"fileName",e.data[0].fileName),t.$set(t.recordForm,"fileUrl",e.data[0].fileUrl)):(t.$message.error("上传失败，请检查重新上传"),t.recheckFileList=JSON.parse(s()(t.recheckFileList)))})}else t.$message.error("文件出错或文件已存在，无法覆盖"),t.recheckFileList=JSON.parse(s()(t.recheckFileList))})},cancelSub:function(){this.closeCurrent(this.$store.state.tagsView.visitedViews,this.$route,"/contract")},inputXz:function(e,t){e.target.value>=9999999&&(e.target.value=9999999),""!=e&&(e.target.value=e.target.value.match(/^\d*(\.?\d{0,2})/g)[0]||null),1==t&&e.target.value&&""!=e.target.value&&(this.recordForm.approvalMoney=e.target.value),2==t&&e.target.value&&""!=e.target.value&&(this.recordForm.paymentAmount=e.target.value),3==t&&e.target.value&&""!=e.target.value&&(this.recordForm.commission=e.target.value)},getPaymentData:function(e){var t=this,a={options:[]},r={options:[]};Object(n.q)({orderId:e}).then(function(e){200===e.code&&(e.data.forEach(function(e){e.paymentModeType?(a.lable="历史回款阶段",a.options.push(e),t.payMethods.push(a)):(r.lable="",r.options.push(e))}),t.payMethods.push(r))})}}},v={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"headerTop",attrs:{slot:"header"},slot:"header"},[r("div",{staticClass:"headerLeft"},[r("span",{staticClass:"conditionChoose"},[e._v("回款详情")])])]),e._v(" "),r("div",{staticClass:"paymentCont"},[r("el-row",[r("el-col",{attrs:{span:12}},[r("p",{staticClass:"payName"},[e._v("\n              客户名称：\n              "),r("span",[e._v(e._s(e.recordForm.crmCompanyName))]),e._v(" "),e.isCheck||0!=e.recordForm.financeRecheck||0!=e.recordForm.supervisorRecheck?e._e():r("img",{staticStyle:{"vertical-align":"middle","margin-left":"3px",cursor:"pointer"},attrs:{src:a("qzBd")},on:{click:e.openEdit}})])]),e._v(" "),r("el-col",{attrs:{span:12}},[r("p",{staticClass:"payName"},[e._v("客户类别："),r("span",[e._v(e._s(e.recordForm.companyLevelName))])])])],1)],1)]),e._v(" "),r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"headerTop",attrs:{slot:"header"},slot:"header"},[r("div",{staticClass:"headerLeft"},[r("span",{staticClass:"conditionChoose condOring"},[e._v("合同信息")])])]),e._v(" "),r("div",{staticClass:"paymentCont"},[r("el-row",[r("el-col",{attrs:{span:8}},[r("p",{staticClass:"payName"},[e._v("合同编号："),r("span",[e._v(e._s(e.recordForm.contractCode))])])]),e._v(" "),r("el-col",{attrs:{span:8}},[r("p",{staticClass:"payName"},[e._v("创建日期："+e._s(e.recordForm.createDate))])]),e._v(" "),r("el-col",{attrs:{span:8}},[r("p",{staticClass:"payName"},[e._v("有效期："+e._s(e.recordForm.availableYear+"年"))])])],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:8}},[r("p",{staticClass:"payName"},[e._v("签订人："),r("span",[e._v(e._s(e.recordForm.signUserName))])])]),e._v(" "),r("el-col",{attrs:{span:8}},[r("p",{staticClass:"payName"},[e._v("签约日期："+e._s(e.recordForm.signDate))])]),e._v(" "),r("el-col",{attrs:{span:8}},[r("p",{staticClass:"payName"},[e._v("签约公司："+e._s(e.recordForm.signCompanyName))])])],1)],1)]),e._v(" "),r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"headerTop",attrs:{slot:"header"},slot:"header"},[r("div",{staticClass:"headerLeft"},[r("span",{staticClass:"conditionChoose condOring"},[e._v("项目信息")])])]),e._v(" "),r("div",{staticClass:"paymentCont"},[r("el-row",[r("el-col",{attrs:{span:12}},[r("p",{staticClass:"payName"},[e._v("项目名称："),r("span",[e._v(e._s(e.recordForm.projectName))])])]),e._v(" "),r("el-col",{attrs:{span:12}},[r("p",{staticClass:"payName"},[e._v("工程师："),r("span",[e._v(e._s(e.recordForm.engineerUserName))])])])],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:6}},[r("p",{staticClass:"payName"},[e._v("年份："+e._s(e.recordForm.year))])]),e._v(" "),r("el-col",{attrs:{span:6}},[r("p",{staticClass:"payName"},[e._v("批次：\n              "+e._s(0==e.recordForm.batch?"未指定":1==e.recordForm.batch?"第一批":2==e.recordForm.batch?"第二批":3==e.recordForm.batch?"第三批":4==e.recordForm.batch?"第四批":5==e.recordForm.batch?"第五批":"-"))])]),e._v(" "),r("el-col",{attrs:{span:6}},[r("p",{staticClass:"payName"},[e._v("数量："+e._s(e.recordForm.applyNum))])])],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:6}},[r("p",{staticClass:"payName"},[e._v("批准金额：")]),e._v(" "),e.isCheck?r("el-input",{attrs:{type:"number",size:"small",maxlength:"7",oninput:"value=value.replace(/[^0-9.]/g,'');"},nativeOn:{input:function(t){return e.inputXz(t,1)}},model:{value:e.recordForm.approvalMoney,callback:function(t){e.$set(e.recordForm,"approvalMoney",t)},expression:"recordForm.approvalMoney"}},[r("template",{slot:"append"},[e._v("元")])],2):r("p",{staticClass:"payName"},[e._v(e._s(e.recordForm.approvalMoney+"元"))])],1)],1)],1)]),e._v(" "),r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"headerTop",attrs:{slot:"header"},slot:"header"},[r("div",{staticClass:"headerLeft"},[r("span",{staticClass:"conditionChoose condOring"},[e._v("回款信息")])])]),e._v(" "),r("div",{staticClass:"paymentCont"},[r("el-row",[r("el-col",{attrs:{span:5}},[r("p",{staticClass:"payName"},[e._v("汇款日期：")]),e._v(" "),e.isCheck?r("el-date-picker",{attrs:{size:"small",type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.recordForm.paymentDate,callback:function(t){e.$set(e.recordForm,"paymentDate",t)},expression:"recordForm.paymentDate"}}):r("p",{staticClass:"payName"},[r("span",[e._v(e._s(e.recordForm.paymentDate))])])],1),e._v(" "),r("el-col",{attrs:{span:5}},[r("p",{staticClass:"payName"},[e._v("回款金额/比例：")]),e._v(" "),e.isCheck?r("el-input",{attrs:{size:"small",type:"number",maxlength:"7",oninput:"value=value.replace(/[^0-9.]/g,'');"},nativeOn:{input:function(t){return e.inputXz(t,2)}},model:{value:e.recordForm.paymentAmount,callback:function(t){e.$set(e.recordForm,"paymentAmount",t)},expression:"recordForm.paymentAmount"}},[r("template",{slot:"append"},[e._v("元")])],2):r("p",{staticClass:"payName"},[e._v(e._s(e.recordForm.paymentAmount+"元"))])],1),e._v(" "),r("el-col",{attrs:{span:5}},[r("p",{staticClass:"payName"},[e._v("回款阶段：")]),e._v(" "),e.isCheck?r("el-select",{attrs:{placeholder:"回款阶段",clearable:"",size:"small"},model:{value:e.recordForm.paymentType,callback:function(t){e.$set(e.recordForm,"paymentType",t)},expression:"recordForm.paymentType"}},e._l(e.payMethods,function(t){return r("el-option-group",{key:t.lable,attrs:{label:t.lable}},e._l(t.options,function(e){return r("el-option",{key:e.paymentMode,attrs:{label:e.paymentModeName,value:e.paymentMode}})}),1)}),1):r("p",{staticClass:"payName"},[e._v("\n              "+e._s(0==e.recordForm.paymentType?"签约后":1==e.recordForm.paymentType?"受理后":2==e.recordForm.paymentType?"完成（提交）后":3==e.recordForm.paymentType?"立项公示后":4==e.recordForm.paymentType?"拨付后":5==e.recordForm.paymentType?"验收后":6==e.recordForm.paymentType?"收到通知书后":"-")+"\n            ")])],1),e._v(" "),r("el-col",{attrs:{span:5}},[r("p",{staticClass:"payName"},[e._v("财政级别：")]),e._v(" "),e.isCheck?r("el-select",{attrs:{placeholder:"财政级别",clearable:"",size:"small"},model:{value:e.recordForm.paymentLevel,callback:function(t){e.$set(e.recordForm,"paymentLevel",t)},expression:"recordForm.paymentLevel"}},e._l(e.paymentLevelList,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1):r("p",{staticClass:"payName"},[e._v("\n              "+e._s(1==e.recordForm.paymentLevel?"国家级":2==e.recordForm.paymentLevel?"省级":3==e.recordForm.paymentLevel?"市级":4==e.recordForm.paymentLevel?"区县级":5==e.recordForm.paymentLevel?"镇街级":"-")+"\n            ")])],1),e._v(" "),r("el-col",{attrs:{span:4}},[r("p",{staticClass:"payName"},[e._v("收款人：")]),e._v(" "),e.isCheck?r("el-select",{attrs:{placeholder:"收款人",clearable:"",size:"small"},model:{value:e.recordForm.paymentUserId,callback:function(t){e.$set(e.recordForm,"paymentUserId",t)},expression:"recordForm.paymentUserId"}},e._l(e.userList,function(e){return r("el-option",{key:e.userId,attrs:{label:e.userName,value:e.userId}})}),1):r("p",{staticClass:"payName"},[e._v(e._s(e.recordForm.paymentUserName))])],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:5}},[r("p",{staticClass:"payName"},[e._v("录入日期："+e._s(e.recordForm.entryDate))])])],1)],1)]),e._v(" "),r("el-card",{staticClass:"box-card"},[e.recordForm.file?r("p",{staticClass:"payName"},[e._v("\n        我是凭证：\n        "),r("span",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.downloadFile(e.recordForm.file)}}},[e._v(e._s(e.recordForm.file.fileName))])]):e._e(),e._v(" "),e.fileForm.file?r("p",{staticClass:"payName"},[e._v("\n        回款依据：\n        "),r("span",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.downloadFile(e.fileForm.file)}}},[e._v(e._s(e.fileForm.file.fileName))])]):e._e(),e._v(" "),r("p",[r("img",{staticStyle:{"max-width":"100%","margin-top":"10px"},attrs:{src:e.recordForm.fileUrl,alt:""}})])]),e._v(" "),r("div",{staticClass:"btnList"},[e.isCheck&&e.recordForm.recordId&&0==e.recordForm.financeRecheck&&0==e.recordForm.supervisorRecheck?r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.editPayment}},[e._v("提交")]):e._e(),e._v(" "),e.recordForm.recordId&&e.recordForm.supportRecheck?r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.openRecheck}},[e._v("审核")]):e._e(),e._v(" "),r("el-button",{attrs:{size:"small"},on:{click:e.cancelSub}},[e._v("取消")])],1),e._v(" "),r("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"审核",visible:e.dialogVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("div",{staticStyle:{display:"flex"}},[r("span",[e._v("上传凭证：")]),e._v(" "),r("el-upload",{staticClass:"image-uploader",attrs:{"http-request":e.handleUpload,"before-upload":e.uploadBeforeFile,"file-list":e.recheckFileList,limit:1,"on-exceed":e.handleExceed,action:""}},[r("el-button",{staticClass:"btn export",attrs:{type:"primary",size:"small"}},[e._v("上传")])],1),e._v(" "),r("p",{staticStyle:{"margin-top":"10px","font-size":"12px",color:"#ff3f4b","line-height":"normal"}},[e._v("限制文件不超过"+e._s(e.$store.getters.singleCapacity/1024+"M"))])],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),e.recordForm.recordId?r("el-button",{attrs:{size:"small",type:"info"},on:{click:function(t){return e.recheckPayment(2)}}},[e._v("不通过")]):e._e(),e._v(" "),e.recordForm.recordId?r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.recheckPayment(1)}}},[e._v("通过")]):e._e()],1)])],1)},staticRenderFns:[]};var h=a("VU/8")(p,v,!1,function(e){a("dX4b")},"data-v-23f33d73",null);t.default=h.exports},dX4b:function(e,t,a){var r=a("B91U");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("rjj0")("0561513b",r,!0)}});